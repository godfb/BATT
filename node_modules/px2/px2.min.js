function Event(a,b){return this.target=a,this.value=b,this}function Class(a){if(this._parents=[],this._props={},this._actions={},this._storage=[],a&&a.defaults)for(var b in a.defaults)this.create(b,a.defaults[b]);for(var c in a)this[c]=a[c];if(this.length=0,this.init){var d=Array.prototype.slice.call(arguments,1);this.init.apply(this,d)}return this}function Classp(a){return"object"==typeof a&&Array.isArray(a._storage)&&Array.isArray(a._parents)}function addParent(a,b,c){return Classp(a)?(a._parents.push(b),b.once("change:"+c,function(b){return a._parents.remove(b.target)})):void 0}function getset(a,b,c){return 1===arguments.length?this.get(a):this.set(a,b,c)}function View(a,b){if(this.model=b,this.$el=$("<div>"),a&&(a.tagName&&(this.$el=$("<"+a.tagName+">")),a.style&&this.$el.css(a.style),a.model&&(this.model=a.model,delete a.model),this.$el.attr("class",a.className||a.type),a.events))for(var c in a.events)this.$el.on(c,a.events[c].bind(this));return Class.apply(this,arguments),this}Array.prototype.remove=function(a){for(var b=0,c=null,d=0;d<this.length;d+=1){if(c=this[d],c===a)return this.splice(b,1),!0;++b}return null},Class.prototype.get=function(a,b){if(!this._props.hasOwnProperty(a))throw new Error("Attempt to get a property "+a+" that does not exist.");return b||(this.trigger("get",this[a]),this.trigger("get:"+a,this[a])),this._props[a]},Class.prototype.create=function(a,b,c){if(this._props.hasOwnProperty(a))throw new Error("Attempt to create property "+a+" that already exists.");return this._props[a]=b,this[a]=getset.bind(this,a),addParent(b,this,a),c||(this.trigger("create",b),this.trigger("create:"+a,b)),b},Class.prototype.set=function(a,b,c){if(!this._props.hasOwnProperty(a))throw new Error("Attempt to set a property "+a+" that does not exist.");return c||(this.trigger("change",b),this.trigger("change:"+a,b)),addParent(b,this,a),this._props[a]=b},Class.prototype.destroy=function(a){var b=this._props[a];return delete this._props[a],delete this._actions["change:"+a],delete this[a],this.trigger("destroy",b)},Class.prototype.trigger=function(a,b,c){var d=this._actions[a],e=null;if(d){for(var f=new Event(c||this,b),g=[],h=null,i=0;i<d.length;i+=1)h=d[i],h.fun.call(h.self,f)&&(e=!0),h.once&&g.push(h);for(var h=null,j=0;j<g.length;j+=1)h=g[j],d.remove(h)}else e=!0;if(e)for(var k=null,l=this._parents,m=0;m<l.length;m+=1)k=l[m],k!==c&&this.trigger.call(k,a,b,c||this)},Class.prototype.on=function(a,b,c){var d={message:a,fun:b,self:c||this};return this._actions[a]?this._actions[a].push(d):this._actions[a]=[d],d},Class.prototype.once=function(a,b,c){var d={message:a,fun:b,self:c||this,once:!0};return this._actions[a]?this._actions[a].push(d):this._actions[a]=[d],d},Class.prototype.push=function(a,b){if(this.contains&&a.type!==this.contains)throw new Error("Attempt to push "+a.type+"into container for "+this.contains);return Classp(a,b)&&a._parents.push(this),this._storage.push(a),this.length=this._storage.length,b||(this.trigger("add",a),this.trigger("change",a)),a},Class.prototype.add=function(a,b){if(this.contains&&a.type!==this.contains)throw new Error("Attempt to push "+a.type+"into container for "+this.contains);return this.find(a)||this.push(a,b),a},Class.prototype.remove=function(a,b){var c=this._storage.remove(a);return c&&(--this.length,b||(this.trigger("remove",a),this.trigger("change",a))),c},Class.prototype.clear=function(a){return this._storage=[],this.length=0,a?void 0:(this.trigger("clear",this),this.trigger("change",null))},Class.prototype.at=function(a){if(a>=this.length)throw new error("attempt to index ("+a+") out of range of object ("+this.length+")");return this._storage[a]},Class.prototype.each=function(a,b){for(var c=b||this,d=null,e=this._storage,f=0;f<e.length;f+=1)d=e[f],a.call(c,d)},Class.prototype.map=function(a,b){for(var c=[],d=b||this,e=null,f=this._storage,g=0;g<f.length;g+=1)e=f[g],c.push(a.call(d,e));return c},Class.prototype.filter=function(a,b){for(var c=[],d=b||this,e=null,f=this._storage,g=0;g<f.length;g+=1)e=f[g],a.call(d,e)&&c.push(e);return c},Class.prototype.find=function(a){if("function"==typeof a){for(var b=null,c=this._storage,d=0;d<c.length;d+=1)if(b=c[d],a(b))return b}else for(var b=null,e=this._storage,f=0;f<e.length;f+=1)if(b=e[f],a===b)return b},Class.prototype.sort=function(a,b){return this._storage.sort(a),b||(this.trigger("change",this),this.trigger("sorted",this)),this},View.prototype=Object.create(Class.prototype),View.prototype.constructor=View,"undefined"!=typeof module&&(module.exports.Class=Class),"undefined"!=typeof module&&(module.exports.View=View);